<!-- templates/data_analysis/upload.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Upload</title>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body class="bg-info" style="--bs-bg-opacity: .5;">
    <div class = "container" id="dataview">
        
        {% if table_data %}
            <div class="mt-50px" >
                <h1 class =" d-flex justify-content-center">Data Table</h1>
                <div class="d-flex justify-content-center">
                    <table class="table table-hover bg-info table-striped" style="--bs-bg-opacity: .5;" >
                        <tr>
                            <th scope="col">Index</th>
                            <th scope="col">Value</th>
                        </tr>
                        {% for row in table_data %}
                            <tr>
                                
                                <td>{{ row.0 }}</td>  <!-- Index -->
                                <td>{{ row.1 }}</td>  <!-- Value -->
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        {% endif %}

        <!-- {% if line_graph_url %}
            <h2>Line Graph</h2>
            <img src="data:image/png;base64,{{ line_graph_url }}" alt="Data Line Graph" class="img-fluid" />
        {% endif %}
        {% if bar_graph_url %}
            <h2>Bar Graph</h2>
            <img src="data:image/png;base64,{{ bar_graph_url }}" alt="Data Bar Graph" class="img-fluid" />
        {% endif %}
        {% if pie_graph_url %}
            <h2>Bar Graph</h2>
            <img src="data:image/png;base64,{{ pie_graph_url }}" alt="Data Pie Graph" class="img-fluid" />
        {% endif %} -->
        <div class="container text-center">
            <h1>Generated Graph</h1>

            {% if graph_url %}
                <img src="data:image/png;base64,{{ graph_url }}" alt="Selected Graph" class="img-fluid" />
            {% else %}
                <p>No graph generated.</p>
            {% endif %}
          </div>

        

        
    </div>
    <button onclick="exportToPDF()" class="btn btn-success">Export as PDF</button>
    
<script>
    
    function exportToPDF() {
        console.log("fun called.")
        
        html2canvas(document.getElementById("dataview")).then(function(canvas) {
            var imgData = canvas.toDataURL("image/png");
            var pdf = new jsPDF("p", "mm", "a4");
            pdf.addImage(imgData, "PNG", 10, 10, 190, 0);  // Adjust size as needed

            // Add footer
            const pageHeight = pdf.internal.pageSize.height || pdf.internal.pageSize.getHeight();
            pdf.setFontSize(10);
            pdf.text('Â© 2024 LokiTheGod. All rights reserved.', pdf.internal.pageSize.width / 2-25, pageHeight - 10, { align: "center" });

            // Generate the PDF blob directly
            const blob = pdf.output('blob');
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'data-view.pdf';
            link.click();

            // Release the object URL after download
            URL.revokeObjectURL(url);
        });
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.0.0-alpha.12/html2canvas.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.js" integrity="sha512-sn/GHTj+FCxK5wam7k9w4gPPm6zss4Zwl/X9wgrvGMFbnedR8lTUSLdsolDRBRzsX6N+YgG6OWyvn9qaFVXH9w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.esm.min.js" integrity="sha512-OxXHRCrHZMOqbrhaUX+wMD4pRxO+Ym5CKOf0qsPkBTeBOXBjAKirtaTH87wKgEikZBPOMQPOEqE/3fpWa1wiuQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</body>
</html>
